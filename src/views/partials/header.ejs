<header class="site-header">
  <nav class="nav container" aria-label="Primary">
    <!-- IZQ: logo -->
    <a href="/" class="brand" aria-label="LYN AutoSales">
      <img class="brand__logo" src="/assets/logo.png" alt="LYN AutoSales">
    </a>

    <!-- empuja el resto a la derecha -->
    <div class="nav__spacer"></div>

    <!-- DER: menú + idioma + login + hamburguesa -->
    <div class="nav__right" id="navRight">
      <ul class="nav__links" role="menubar" id="navMenu">
        <li role="none"><a role="menuitem" href="/inventory"><%= __('menu.inventory') %></a></li>
        <li role="none"><a role="menuitem" href="/about"><%= __('menu.about') %></a></li>
        <li role="none"><a role="menuitem" href="/contact"><%= __('menu.contact') %></a></li>
      </ul>

      <!-- Cambio de idioma 1-clic -->
      <form action="/toggle-lng" method="post" class="lang" aria-label="Language">
        <button type="submit" class="lang__btn" title="<%= locale==='es' ? 'Cambiar a EN' : 'Switch to ES' %>">
          <%= (locale || 'es').toUpperCase() %>
        </button>
      </form>

      <!-- Login icono -->
      <a href="/auth/login" class="btn--icon sm" aria-label="<%= __('menu.login') %>">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-9 2.5-9 5.5V22h18v-2.5C21 16.5 17 14 12 14Z" fill="currentColor"/>
        </svg>
      </a>

      <!-- Hamburguesa (solo móvil) -->
      <button id="navToggle" class="nav__toggle" aria-expanded="false" aria-controls="navDrawer" aria-label="Menu">
        <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Drawer móvil -->
  <aside id="navDrawer" class="drawer" hidden>
    <nav aria-label="Mobile">
      <ul class="drawer__links">
        <li><a href="/inventory"><%= __('menu.inventory') %></a></li>
        <li><a href="/about"><%= __('menu.about') %></a></li>
        <li><a href="/contact"><%= __('menu.contact') %></a></li>
        <li class="drawer__row">
          <form action="/toggle-lng" method="post" class="lang"><button type="submit" class="lang__btn block"><%= (locale||'es').toUpperCase() %></button></form>
          <a href="/auth/login" class="btn--icon sm" aria-label="<%= __('menu.login') %>">
            <svg width="20" height="20" viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-9 2.5-9 5.5V22h18v-2.5C21 16.5 17 14 12 14Z" fill="currentColor"/></svg>
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <div id="navBackdrop" class="backdrop" hidden></div>
</header>

<script>
(function(){
  document.querySelectorAll('.mobile-menu,.menu-mobile,.legacy-menu,[data-legacy-menu],.nav-dropdown,.nav__dropdown')
    .forEach(n => n.remove());

  const toggle   = document.getElementById('navToggle');
  const drawer   = document.getElementById('navDrawer');
  const backdrop = document.getElementById('navBackdrop');

  const openDrawer = (open) => {
    drawer?.classList.toggle('open', open);
    backdrop?.classList.toggle('open', open);
    document.body.classList.toggle('no-scroll', open);
    toggle?.setAttribute('aria-expanded', open ? 'true' : 'false');
    drawer?.toggleAttribute('hidden', !open);
    backdrop?.toggleAttribute('hidden', !open);
  };

  toggle?.addEventListener('click', () => openDrawer(!drawer.classList.contains('open')));
  backdrop?.addEventListener('click', () => openDrawer(false));
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') openDrawer(false); });

  drawer?.addEventListener('click', (e)=>{
    const a = e.target.closest('a,button[type="submit"]');
    if (a) openDrawer(false);
  });

  if (drawer && !drawer.querySelector('.drawer__close')) {
    const btn = document.createElement('button');
    btn.className = 'drawer__close'; btn.setAttribute('aria-label','Cerrar');
    btn.innerHTML = '<svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>';
    btn.addEventListener('click', ()=>openDrawer(false));
    drawer.appendChild(btn);
  }

  let lastW = window.innerWidth;
  window.addEventListener('resize', ()=>{
    if (window.innerWidth >= 950 && lastW < 950) openDrawer(false);
    lastW = window.innerWidth;
  });
})();
</script>
